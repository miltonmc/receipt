const URL_NFE = 'http://nfce.sefaz.pe.gov.br/nfce/consulta?p=';
const KEY = '26180347508411018012653160000180751000114908';

const KEY_1 = '261807'
const KEY_2 = '551138000193650080000243139000243134';


const moment = require('moment');
const request = require('request');
const parseString = require('xml2js').parseString;;

const getNFE = (key) => {
    let toReturn;
    request(`${URL_NFE}${key}`, (err, {body}) => {
        if (err) { return console.log(err); }
        parseString(body, {trim: true}, function (err, result) {
            if (result.nfeProc.erro[0] === ''){
              try{
              // 2018-12-10T13:06:33-03:00
              const recipt = result.nfeProc.proc[0].nfeProc[0].NFe[0].infNFe[0];
              const date = moment(recipt.ide[0].dhEmi[0],'YYYY-MM-DD').format('MM/DD/YYYY');
              const nome = recipt.emit[0].xFant ? recipt.emit[0].xFant[0] : recipt.emit[0].xNome[0];
              const total = recipt.total[0].ICMSTot[0].vNF[0];
              // console.log(JSON.stringify(result, null, 4));
              console.log(`${date},,${nome},,${total},,${URL_NFE}${key}`);
              } catch(e){
                console.log(`Error on key: ${key}`);
              }
            }
          });
      });
};

[
  // '26180635627413000428650320000158821880820160',
  // '26180642591651172351650510000630641120819719',
  // '26180645543915028272650040001169921660188391',
  // '26180635627413000428650310000200661151037466',
  // '26180629829698000134650010000052881813396356',
  // '26180747508411018012653060000443681000637378',
  // '26180729829698000134650010000057061491312627',
  // '26180742591651044787650730001488731052268559',
  // '26180735627413000428650390000010981322444910',
  // '26180729829698000134650010000062491873216249',
  // '26180707836789000164650010000191069279361622',
  // '26180747508411117851653050000589831000015190',
  // '26180700779721005968652450000054741637214552',
  // '26180747508411018012653100000455051000002197',
  // '26180829829698000134650010000084351436413363',
  // '26180828306195000111650010001218941001218942',
  // '26180829829698000134650010000094341007503309',
  // '26180829829698000134650010000101159837444859',
  // '26180907836789000164650010000259201168966410',
  // '26180907836789000164650010000259211678129100',
  // '26180907836789000164650010000268781847946889',
  // '26180914643907000183650010000297731060850240',
  // '26181007836789000164650010000283201641222666',
  // '26181007836789000164650010000294631275116389',
  // '26181027540496000142650010000062431836183683',
  // '26181207836789000164650010000357401468584524',
  // '26181207836789000164650010000357411450376412',
  // '26190445543915006112650170001357501243261209',
  // '26190445543915028272650090000360821164047853',
  // '26190413477066002758651640000026941000026949',
  // '26190423547554000532650030000097411842246775',
  // '26190421514324000118650010000515501423091083',
  // '26190447508411018012653090000907861001110942',
  // '26190547508411018012653160000744601000730295',
  // '26190561585865157808650080001181931614192902',
  // '26190545543915028272650020001767881249945552',
  // '26190509515628000447650200000286681003529350',
  // '26190547508411018012653110001109031000353752',
  // '26190507836789000164650010000521101677714465',
  // '26190547508411018012653090000952591001229054',
  // '26190547508411018012653160000754361000765489',
  // '26190500943155000242651080000832391000832392',
  // '26190529829698000134650010000305381495676882',
  // '26190508097305000175650010000478861054357779', // Macunaima
  // '26190530709115000110650010000108981117746550',
  // '26190542591651044787650730003389821120580061',
  // '26190547508411018012653160000755571000770410',
  // '26190504899316038433650010001299121001296628',
  // '26190513574594042603650010003586251433530082',
  // '26190530886396000187650010000313559000323422', // Unitop Padaria
  // '26190547508411018012653100000778721000788275',
  // '26190505603563000198650330000535251051838416',
  // '26190547508411018012653110001128111000402430',
  // '26190626761695000118650010000213771000269848',
  // '26190607836789000164650010000545641659050815',
  // '26190623547554000532650030000118991979239570',
  // '26190647508411018012653160000768241000820055',
  // '26190605683447000126650020000079071093319831',
  // '26190645543915028272650020001890131374958321',
  // '26190610230480000483650010021922111037180366',
  // '26190647508411018012653080000229959000098736',
  // '26190614643907000183650010000755171744819426',
  // '26190635627413000428650410000239461003467222',
  // '26190647508411018012653110001176421000536064',
  // '26190609275194000102650040000469131000486626',
  // '26190747508411117851653090001334261002213670',
  // '26190714643907000183650010000795211955594666',
  // '26190707836789000164650010000578041717219223',
  // '26190709025305000122650810000545341796957114',
  // '26190705603563000198650330000594121051897480',
  // '26190742591651044787650730003780051635835055',
  // '26190729522033000183650010000276941000276946',
  // '26190742591651044787650030001678451778471852',
  // '26190707836789000164650010000578041717219223',
  // '26190742591651044787650030001678361167272810',
  // '26190705603563000198650570000562431000564571',
  // '26190705603563000198650570000603941000606348',
  // '26190747508411117851653090001334261002213670',
  // '26190721595705000179650010000247381071832670',
  // '26190747508411018012653050001323061002365785',
  // '26190745543915028272650060001285351892999260',
  // '26190733014556077571653240000019661168166736',
  // '26190711965515001203651120000829911112144910',
  // '26190703616010000144650010000853251053072794',
  // '26190807836789000164650010000625991699486999',
  // '26190845543915028272650020002170061331759484',
  // '26190811023174003969650650000070991023664416',
  // '26190961585865157808650080001473811846608440',
  // '26190945543915028272650090000998351042994464',
  // '26190845543915028272650020002170061331759484',
  // '26190807836789000164650010000625991699486999',
  // '26190801294927000144650060000309021000324708',
  // '26190803504144000173650030000075871190075873',
  // '26190804899316038433650010001543531001539171',
  // '26190805603563000198650570000649631000652275',
  // '26190842591651044787650730003927711502082649',
  // '26190847508411018012653050001373931002500110',
  // '26190845543915028272650020002128261616434382',
  // '26190847508411117851653160001445481002112450',
  // '26190842591651059628650710001213591815700200',
  // '26190811023174003969650650000070991023664416',
  // '26190942591651044787650730004081811111094147',
  // '26190933746542000167655020000018541002453096',
  // '26190945543915028272650060001622891038344352',
  // '26190933746542000167655020000021331008707703',
  // '26190947508411018012653090001113841001651595',
  // '26190903616010000144650010000903511058216067',
  // '26190961585865126333650080001343821192130217',
  // '26190947508411018012653120001186911002139824',
  // '26190961585865157808650070001051501794446243',
  // '26190961585865126333650080001350371013213590',
  // '26190961585865126333650080001350361625307997',
  // '26190947508411018012653040000801751000774231',
  // '26190918633459000198650020000293431539980067',
  // '26190932477797000109650010000175161005630576',
  // '26190942591651172351650420000630981937459318',
  // '26190930709115000110650010000183681958432770',
  // '26190932477797000109650010000167171083506660',
  // '26190901294927000144650060000397621000420067',
  // '26190920982967000123650010002543511575398580',
  // '26190415239313000174650010000009681887505512',
  // '26190947508411122774653330002032191003290946',
  // '26190913574594042433650010007795991352512012',
  // '26190847508411018012653090001066141001532089',
  // '26190805603563000198650570000630561000633132',
  '26190847508411122774653330001977431003148195',
  '26190807836789000164650010000625991699486999',
  '26190847508411117851653160001445481002112450',
  '26190804899316038433650010001509141001505206',
  // '',
  // '',
  // '',
  // '',
  // '',
  // '',
].forEach(key => getNFE(key));
// let count = 99
// do {
//     const missing = count < 10 ? 0 + count : count;
//     getNFE(KEY_1 + missing + KEY_2)
//     count --;
// } while (count >= 0);